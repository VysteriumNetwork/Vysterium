!function(){var e,t,O=window["%hammerhead%"];if(!O)throw new Error("hammerhead not loaded yet");if(O.settings._settings.sessionId)console.warn("unexpected task.js to load before rammerhead.js. url shuffling cannot be used"),s();else{e=s,t=O.__proto__.start,O.__proto__.start=function(){t.apply(this,arguments),O.__proto__.start=t,e()};var r=new XMLHttpRequest,n=(location.pathname.slice(1).match(/^[a-z0-9]+/i)||[])[0];if(n)if(r.open("GET","/api/shuffleDict?id="+n,!1),r.send(),200!==r.status)console.warn(`received a non 200 status code while trying to fetch shuffleDict:
status: ${r.status}
response: `+r.responseText);else{n=JSON.parse(r.responseText);if(n){const a=(e,t)=>(e%t+t)%t,l="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~-",c="_rhs",u=function(){let e="";for(var t=l.split("");0<t.length;)e+=t.splice(Math.floor(Math.random()*t.length),1)[0];return e};const d=(e,n)=>(e||"").replace(/^((?:[a-z0-9]+:\/\/[^/]+)?(?:\/[^/]+\/))([^]+)/i,function(e,t,r){return t+n(r)}),f=new class{constructor(e=u()){this.dictionary=e}shuffle(t){if(t.startsWith(c))return t;let r="";for(let e=0;e<t.length;e++){var n=t.charAt(e),o=l.indexOf(n);"%"===n&&3<=t.length-e?r=(r=(r+=n)+t.charAt(++e))+t.charAt(++e):r+=-1===o?n:this.dictionary.charAt(a(o+e,l.length))}return c+r}unshuffle(t){if(!t.startsWith(c))return t;t=t.slice(c.length);let r="";for(let e=0;e<t.length;e++){var n=t.charAt(e),o=this.dictionary.indexOf(n);"%"===n&&3<=t.length-e?r=(r=(r+=n)+t.charAt(++e))+t.charAt(++e):r+=-1===o?n:l.charAt(a(o-e,l.length))}return r}}(n);r=location.href,n=d(location.href,e=>f.shuffle(e));r!==n&&history.replaceState(null,null,n);const p=O.utils.url.getProxyUrl,h=O.utils.url.parseProxyUrl;function o(e){return e.replace(/(^.*?:\/)\//,"$1")}function i(e){return e.replace(/^.*?:\/(?!\/)/,"$&/")}O.utils.url.overrideGetProxyUrl(function(e,t){return I?p(e,t):d(p(e,t),e=>o(f.shuffle(e)))}),O.utils.url.overrideParseProxyUrl(function(e){return h(d(e,e=>f.unshuffle(i(e))))}),window.overrideGetProxyUrl(r=>function(e,t){return I?r(e,t):d(r(e,t),e=>o(f.shuffle(e)))}),window.overrideParseProxyUrl(t=>function(e){return t(d(e,e=>f.unshuffle(i(e))))})}}else console.warn("cannot get session id from url")}function s(){{const m=location.port||("https:"===location.protocol?"443":"80"),w=O.utils.url.getProxyUrl;O.utils.url.overrideGetProxyUrl(function(e,t={}){return t.proxyPort||(t.proxyPort=m),w(e,t)}),window.overrideParseProxyUrl(t=>function(e){e=t(e);return e&&e.proxy&&(e.proxy.port||(e.proxy.port=m)),e})}{const g={HTMLAnchorElement:["href"],HTMLAreaElement:["href"],HTMLBaseElement:["href"],HTMLEmbedElement:["src"],HTMLFormElement:["action"],HTMLFrameElement:["src"],HTMLIFrameElement:["src"],HTMLImageElement:["src"],HTMLInputElement:["src"],HTMLLinkElement:["href"],HTMLMediaElement:["src"],HTMLModElement:["cite"],HTMLObjectElement:["data"],HTMLQuoteElement:["cite"],HTMLScriptElement:["src"],HTMLSourceElement:["src"],HTMLTrackElement:["src"]};for(const y in g)for(const v of g[y])if(window[y]){var e=Object.getOwnPropertyDescriptor(window[y].prototype,v);const x=e.get;if(e.get=function(){return e=x.call(this),(O.utils.url.parseProxyUrl(e)||{}).destUrl||e;var e},"action"===v){const P=e.set;e.set=function(e){I=!0;try{var t=P.call(this,e)}catch(e){throw I=!1,e}return I=!1,t}}Object.defineProperty(window[y].prototype,v,e)}else console.warn("unexpected unsupported element class "+y)}{const S=`rammerhead|storage-wrapper|${O.settings._settings.sessionId}|${window.__get$(window,"location").host}|`,b=(e="")=>S+e,T=(e="")=>e.startsWith(S)?e.slice(S.length):null,E=(e,o)=>{const i=["internal","clear","key","getItem","setItem","removeItem","length"];Object.defineProperty(window,e,{configurable:!0,writable:!0,value:new Proxy(window[e],{get(e,t,r){if(i.includes(t)&&"length"!==t)return Reflect.get(e,t,r);if("length"!==t)return o[b(t)];{let e=0;for(var[n]of Object.entries(o))T(n)&&e++;return e}},set(e,t,r){return i.includes(t)||(o[b(t)]=r),!0},deleteProperty(e,t){return delete o[b(t)],!0},has(e,t){return b(t)in o||t in e},ownKeys(){var e,t=[];for([e]of Object.entries(o)){var r=T(e);r&&!i.includes(r)&&t.push(r)}return t},getOwnPropertyDescriptor(e,t){return Object.getOwnPropertyDescriptor(o,b(t))},defineProperty(e,t,r){return i.includes(t)||Object.defineProperty(o,b(t),r),!0}})})},L=(e,n)=>{Storage.prototype[e]=new Proxy(Storage.prototype[e],{apply(e,t,r){return n.apply(t,r)}})};E("localStorage",O.storages.localStorageProxy.internal.nativeStorage),E("sessionStorage",O.storages.sessionStorageProxy.internal.nativeStorage),L("clear",function(){for(var[e]of Object.entries(this))delete this[e]}),L("key",function(e){return(Object.entries(this)[e]||[])[0]||null}),L("getItem",function(e){return this.internal.nativeStorage[b(e)]||null}),L("setItem",function(e,t){e&&(this.internal.nativeStorage[b(e)]=t)}),L("removeItem",function(e){delete this.internal.nativeStorage[b(e)]})}if(delete window.overrideGetProxyUrl,delete window.overrideParseProxyUrl,delete window.overrideIsCrossDomainWindows,window.rammerheadStartListeners){for(const M of window.rammerheadStartListeners)try{M()}catch(e){console.error(e)}delete window.rammerheadStartListeners}if(window.rammerheadDisableLocalStorageImplementation)delete window.rammerheadDisableLocalStorageImplementation;else{var r="rammerhead_synctimestamp",t=!1,n=localStorage,o=n.internal.nativeStorage,i=O.settings._settings.sessionId,s=window.__get$(window,"location").origin,a=[];try{t=!0;var l,c=function(){var e=o[r],t=parseInt(e);if(isNaN(t))return e&&console.warn("invalid timestamp retrieved from storage: "+e),null;return t}();function u(e){if(!e||"object"!=typeof e)throw new TypeError("data must be an object");for(var t in n.clear(),e)n[t]=e[t]}c?(l=p({type:"sync",timestamp:c,data:n})).timestamp&&(d(l.timestamp),u(l.data)):(l=p({type:"sync",fetch:!0})).timestamp&&(d(l.timestamp),u(l.data)),t=!1}catch(e){if("server wants to disable localStorage syncing"!==e.message)throw e;return}n.addChangeEventListener(function(e){t||-1===a.indexOf(e.key)&&a.push(e.key)}),setInterval(function(){var e=h();e&&(p({type:"update",updateData:e},function(e){d(e.timestamp)}),a=[])},5e3),document.addEventListener("visibilitychange",function(){var e;"hidden"===document.visibilityState&&(e=h())&&O.nativeMethods.sendBeacon.call(window.navigator,f(),JSON.stringify({type:"update",updateData:e}))})}function d(e){if(!e)throw new TypeError("timestamp must be defined");if(isNaN(parseInt(e)))throw new TypeError("timestamp must be a number. received"+e);o[r]=e}function f(){return"/syncLocalStorage?sessionId="+encodeURIComponent(i)+"&origin="+encodeURIComponent(s)}function p(e,t){if(!e||"object"!=typeof e)throw new TypeError("data must be an object");var r=O.createNativeXHR();function n(){if(404===r.status)throw new Error("server wants to disable localStorage syncing");if(200!==r.status)throw new Error("server sent a non 200 code. got "+r.status+". Response: "+r.responseText)}if(r.open("POST",f(),!!t),r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify(e)),!t)return n(),JSON.parse(r.responseText);r.onload=function(){n(),t(JSON.parse(r.responseText))}}function h(){if(!a.length)return null;for(var e={},t=0;t<a.length;t++)e[a[t]]=n[a[t]];return a=[],e}}var I=!1}();